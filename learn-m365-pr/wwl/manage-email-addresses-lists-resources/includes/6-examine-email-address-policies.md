In Exchange Server, email addresses for recipients are generated by email address policies. Email address policies define the rules that create email addresses for recipients in your Exchange Server organization. Email address policies in Exchange Server 2016 and Exchange Server 2019 are basically unchanged from Exchange Server 2010.

> [!NOTE]
> Email address policies aren't available in Exchange Online.

By default, Exchange Server contains an email address policy that assigns one or more email addresses to every recipient. However, you can modify the default email address policy and create custom email address policies.

The basic components of an email address policy are:

 -  **Email address templates.** Define the email address format for the recipients (for example &lt;firstname&gt;@contoso.com or &lt;lastname&gt;.&lt;firstname&gt;@contoso.com).
 -  **Recipient filter.** Specifies the recipients whose email addresses are configured by the policy.
 -  **Priority.** Specifies the order to apply the email address policies (important if a recipient is identified by more than one policy).

### Email address templates

An email address template contains the address type and the address format. An email address policy can contain multiple email address templates. One template must define the primary (reply) SMTP email address, and there can be only one primary SMTP email address defined in the policy (it's the Reply-To: email address for recipients). Other email address templates in the policy define the extra or *proxy* addresses for recipients.

**Further reading.** For more information on email address templates, address types, and address formats, see [Email address policies in Exchange Server](/Exchange/email-addresses-and-address-books/email-address-policies/email-address-policies?azure-portal=true).

### Recipient filters

Recipient filters identify the recipients the email address policy applies to. There are two basic options: precanned recipient filters and custom recipient filters. These filters are basically the same recipient-filtering options that are used by dynamic distribution groups and address books. The following table summarizes the differences between the two methods.

:::row:::
  :::column:::
    **Recipient filtering method**
  :::column-end:::
  :::column:::
    **User interface**
  :::column-end:::
  :::column:::
    **Filterable recipient properties**
  :::column-end:::
  :::column:::
    **Filter operators**
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    Precanned recipient filters
  :::column-end:::
  :::column:::
    Exchange admin center (EAC) and the Exchange Management Shell
  :::column-end:::
  :::column:::
    Limited to:
• Recipient type (All recipient types or any combination of user mailboxes, resource mailboxes, mail contacts, mail users, and groups)
• Company
• Custom Attribute 1 to 15
• State or Province
• Department
  :::column-end:::
  :::column:::
    Property values require an exact match. Wildcards and partial matches aren't supported. For example, "Sales" doesn't match the value "Sales and Marketing".
Multiple values of the same property always use the or operator. For example, "Department equals Sales or Department equals Marketing".

Multiple properties always use the and operator. For example, "Department equals Sales and Company equals Contoso".
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    Custom recipient filters
  :::column-end:::
  :::column:::
    Exchange Management Shell only
  :::column-end:::
  :::column:::
    You can use virtually any available recipient attributes.
  :::column-end:::
  :::column:::
    You use OPATH filter syntax to specify any available Windows PowerShell filter operators. Wildcards and partial matches are supported.
  :::column-end:::
:::row-end:::


> [!NOTE]
> You can't use precanned filters and customized filters at the same time.

### Priority of email address policies

If a recipient is identified by multiple email address policies, the recipient's email addresses are only configured by the first email address policy that's evaluated. You configure the order in which the policies are evaluated by using the priority of the policy.

 -  A lower priority number indicates a higher priority.
 -  Higher priority policies are evaluated first.
 -  The default email address policy is always evaluated last.

> [!TIP]
> It's recommended that you assign a higher priority (lower number) to policies that use the most specific or restrictive recipient filters.

Some other issues to consider include:

 -  A recipient can only be affected by one email address policy. After the recipient is matched by the filtering properties of the policy, all other policies are ignored.
 -  All email address policies, including policies that have never been applied, are evaluated based on priority. For example, if you have a priority 1 policy and a priority 2 policy that both identity a recipient, the match in the first policy prevents the second policy from updating the recipient's email addresses, *even if the first policy has never been applied to the recipient*.

### Default email address policy

Exchange Server setup creates a default email address policy that applies email addresses to all recipients in your organization. The properties of the default email address policy include:

 -  **Name**: Default Policy
 -  **Priority**: Lowest (all other email address policies are evaluated before the default policy).
 -  **Email address format**
    
     -  **Type**: SMTP (primary email address)
     -  **Domain**: &lt;alias&gt;@&lt;ADForestRootFQDN&gt;. This domain value is used because it's the first accepted domain in the Exchange organization.
 -  **Apply t**o: All recipient types.

> [!IMPORTANT]
> You can't delete the default email address policy, and you can't designate another policy as the default.

You can modify some properties of the default policy, but the modification options are limited:

 -  You can't filter recipients by type or properties (applies to all recipient types).
 -  You can't change the name or priority of the policy.
 -  You can fully customize the email address templates in the policy (modify, add, or remove templates). For more information, see [Modify email address policies](/Exchange/email-addresses-and-address-books/email-address-policies/eap-procedures?azure-portal=true).

### Accepted domains

The SMTP domains that are available to use in email address policies are defined by the *accepted domains* that are configured in the Exchange organization (specifically, authoritative domains and internal relay domains). An accepted domain is an SMTP namespace that you configure in the Exchange organization so that Exchange servers accept messages sent to that SMTP namespace.

By default, an Exchange Server contains an email address policy that assigns one or more email addresses to every mail-enabled user. This default policy specifies the recipients’ alias as the local part of the email address and uses the default accepted domain.

The local part of an email address is the name that appears before the @ symbol. However, you can configure how your recipients’ email addresses display. For example, you can specify that the addresses display as firstname.lastname@contoso.com. To specify extra email addresses for all recipients or just a subset of recipients, you can modify the default policy or create more email address policies. For example, the user mailbox for Franklin Forester can receive email messages addressed to fforester@contoso.com and franklin.forester@contoso.com.

Each time a recipient object is modified and saved, Exchange enforces the correct application of the email address criteria and settings. When an email address policy is modified and saved, all associated recipients are updated with the change. If a recipient object is modified, that recipient's email address policy membership is reevaluated and enforced.

Exchange Server always ensures the email address that's assigned to a mailbox is unique. For example, if two users have the same first name and last name, Exchange Server appends a number to the local part of the second user’s email address when the email address policy assigns an email address to the mailbox and the email address is based on the user’s first name and last name.

**Further reading.** For more information, see [Accepted domains in Exchange Server](/Exchange/mail-flow/accepted-domains/accepted-domains?azure-portal=true).

### Create an email address policy

For a recipient to receive or send email messages, the recipient must have an email address. Email address policies generate the primary and secondary email addresses for your recipients (which include users, contacts, and groups) so they can receive and send email.

When creating an email address policy in the Exchange admin center using the Email Address Policy Wizard, a default set of recipient scope filters is provided for you. These filters include:

 -  All recipient types
 -  Users with Exchange mailboxes
 -  Mail users with external email addresses
 -  Resource mailboxes
 -  Mail contacts with external email addresses
 -  Mail-enabled groups

You can also configure a rule that filters the recipients to which the email-address policy applies. Recipients can be filtered based on the following categories:

 -  Recipient container
 -  State or province
 -  Company
 -  Department
 -  Custom attributes

When creating an email-address policy, you can use the following email address types:

 -  **Default SMTP email address.** Default SMTP email addresses are commonly used email address types that Exchange Server provides for you.
 -  **Custom SMTP email address.** If you don’t want to use one of the default SMTP email addresses, you can specify a custom SMTP email address. When creating a custom SMTP email address, you can use the variables in the following table to specify alternate values for the local part of the email address.

:::row:::
  :::column:::
    **Variable**
  :::column-end:::
  :::column:::
    **Value**
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %g
  :::column-end:::
  :::column:::
    Given name (first name)
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %i
  :::column-end:::
  :::column:::
    Middle initial
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %s
  :::column-end:::
  :::column:::
    Surname (last name)
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %d
  :::column-end:::
  :::column:::
    Display name
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %m
  :::column-end:::
  :::column:::
    Exchange alias
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %xs
  :::column-end:::
  :::column:::
    Uses the x number of letters of the surname. For example, if x=2, the first two letters of the surname are used.
  :::column-end:::
:::row-end:::
:::row:::
  :::column:::
    %xg
  :::column-end:::
  :::column:::
    Uses the x number of letters of the given name. For example, if x=2, the first two letters of the given name are used.
  :::column-end:::
:::row-end:::


Email address policies can be created using the Exchange admin center or the Exchange Management Shell.

### Create an email address policy using the Exchange admin center

Complete the following steps to create an email address policy using the EAC on your Exchange Server:

1.  Navigate to **Mail flow** &gt; **Email address policies**, and then select the **Add** icon.
2.  In **Email Address Policy**, complete the following fields:
    
     -  **Policy name**
     -  **Email address format**
     -  **Specify the types of recipients this email address will apply to**
3.  Select **Add a rule** to further restrict the recipients this policy will apply to. This option creates a Boolean **And** statement.
4.  To view the recipients the policy will apply to, select **Preview recipients the policy applies to**.
5.  Select **Save** to save your changes and create the policy.
6.  You’ll receive a warning that the email address policy won’t be applied until you update it. After it’s created, select it, and then in the details pane, Select **Apply**.

### Create an email address policy using the Exchange Management Shell

The following example creates an email address policy that includes mailbox users in the “Southeast Offices.” These users will have email addresses that include their last name combined with the first two letters of their first name:

```powershell
New-EmailAddressPolicy -Name "southeast offices" -IncludedRecipients MailboxUsers -ConditionalStateorProvince "Georgia","Alabama","Louisiana" -EnabledEmailAddressTemplates "SMTP:%s%2g@southeast.contoso.com"
```

## Knowledge check

Choose the best response for the following question. Then select **Check your answers**.