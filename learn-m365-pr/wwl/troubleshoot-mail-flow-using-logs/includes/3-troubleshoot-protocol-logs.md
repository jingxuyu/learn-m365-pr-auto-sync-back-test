Protocol logging is a source of information where Messaging administrators can view the SMTP conversations that occur as part of message delivery between messaging servers, and between Exchange Server services in the transport pipeline. Protocol logging can be enabled on SMTP Send and SMTP Receive connectors to log the activity of each connector. These logs show the SMTP commands sent between the source and destination, and the IP addresses of the source and destination.

Protocol logs are useful for:

 -  identifying why connectivity is failing.
 -  verifying that a host is communicating with the correct connector.

The prior unit examined how Message tracking logs are used to analyze all message activity as mail flows through the transport pipeline on an Exchange server. In comparison, protocol logs are used to analyze and troubleshoot issues that are related to a specific connector. For example:

 -  If there are issues only when sending email to users on the Internet, the protocol logs generated by the Front-End Transport service Internet send connector should be analyzed.
 -  If you suspect that a user can't send email to different users where email is sent over multiple connectors, then message tracking logs should be analyzed to troubleshoot the issue.

Protocol logging provides detailed information that helps diagnose mail-flow problems by logging the SMTP conversations between the following components:

 -  Send connectors and Receive connectors in the Transport service on Mailbox servers.
 -  Send connectors and Receive connectors in the Transport service on Edge Transport servers.
 -  Receive connectors in the Front-End Transport service on Mailbox servers.
 -  The implicit and invisible intra-organization Send connector in the Transport service on Mailbox servers.
 -  The implicit and invisible intra-organization Send connector in the Front-End Transport service on Mailbox servers.
 -  The implicit and invisible intra-organization Send connector in the Mailbox Transport Submission service on Mailbox servers.
 -  The implicit and invisible Mailbox Delivery Receive connector in the Mailbox Transport Delivery service on Mailbox servers.

By default, protocol logging is enabled on the following connectors only and disabled for all others:

 -  The default Receive connector in the Front-End Transport service on Mailbox servers. Its name is in the Default Frontend ServerName naming format.
 -  The implicit and invisible Send connector in the Front-End Transport service on Mailbox servers.

Connector logs are stored in the following location in the file system, depending on the server type:

 -  %ExchangeInstallPath%TransportRoles\\Logs\\\*\\ProtocolLog\\SmtpReceive
 -  %ExchangeInstallPath%TransportRoles\\Logs\\\*\\ProtocolLog\\SmtpSend

Consider also that the default maximum size of protocol log files is 10 MB and the default maximum age is 30 days.

The naming convention for protocol log files is **SENDyyyymmdd-nnnn.log** for Send connectors and **RECVyyyymmdd-nnnn.log** for Receive connectors. The placeholders represent the following information:

 -  **yyyymmdd** is the date when the log file was created.
 -  **nnnn** is an instance number that is reset to a value of 1 every day.

For example, let’s assume a server produces 50 MB of protocol logs every day and you must search for events in the receive connector logs that happened on the late evening of April 8, 2022. You would open the log file with the name **RECV20220408-0005.log**.

Once the maximum log file size is reached, a new log file is created with an incremented instance number. If a log file reaches its maximum age, or if a log folder reaches its maximum size, then the oldest log file is deleted.

### Activate or deactivate protocol logging

You can enable or disable protocol logging by running the following commands in the Exchange Management Shell:

```powershell
Set-SendConnector <connector> -ProtocolLoggingLevel <Verbose | None>
Set-ReceiveConnector> <connector> -ProtocolLoggingLevel <Verbose | None>

```

The following command syntax should be used to configure the protocol log settings on a Mailbox server:

```powershell
Set-MailboxTransportService <server> ‘  
-ReceiveProtocolLogPath <LocalFilePath> ‘  
-ReceiveProtocolLogMaxFileSize <Size> ‘  
-ReceiveProtocolLogMaxDirectorySize <Size> ‘  
-ReceiveProtocolLogMaxAge <dd.hh:mm:ss> ‘  
-SendProtocolLogPath <LocalFilePath> ‘  
-SendProtocolLogMaxFileSize <Size> ‘  
-SendProtocolLogMaxDirectorySize <Size> ‘  
-SendProtocolLogMaxAge <dd.hh:mm:ss>

```

The data that's captured in both message protocol log files and message tracking logs are written in comma-separated value (CSV) format. Protocol log files use the same log file header format that was described for message tracking logs in the previous unit.

**Further reading**. For more information, see [Fields in the protocol log](/exchange/mail-flow/connectors/protocol-logging?azure-portal=true).

## Knowledge check

Choose the best response for the following question. Then select **Check your answers**.