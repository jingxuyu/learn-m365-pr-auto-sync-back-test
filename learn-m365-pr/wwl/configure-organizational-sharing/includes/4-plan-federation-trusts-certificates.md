Organizations that implement federated sharing must first configure a federation trust with the Azure AD authentication system. This design is the central point for federation trusts.

However, before you configure federation between the two Exchange Server organizations, you must verify which Azure AD authentication system instance each Exchange organization uses. Doing so enables you to determine whether a federation trust already exists between the two organizations.

If a federation trust to the Azure AD authentication system already exists for both Exchange organizations, you donâ€™t need to change the federation trust. Instead, you just have to configure an organization relationship or sharing policy.

To verify the federation trust, you must run the following PowerShell command to determine the value of **uri:federation:MicrosoftOnline** for the **TokenIssuerURIs** parameter:

```powershell
Get-FederationInformation -DomainName <hosted Exchange domain namespace>
```

To establish a federation trust with the Azure AD authentication system, you can use a self-signed certificate or an X.509 certificate signed by a certificate authority (CA). Ensure this certificate is created and installed on the Exchange Server that you used to create the trust.

> [!NOTE]
> It's recommended that you use the self-signed certificate that was automatically created and installed when you ran the Federation Trust Wizard. When the certificate is generated by the Federation Trust wizard, it's automatically deployed to all the Exchange Servers in your organization.

You can also generate a certificate using the **New-ExchangeCertificate** cmdlet. The following example creates a new certificate for federated sharing, and then deploys it to your Exchange Servers as the federation trust certificate:

```powershell
New-ExchangeCertificate -FriendlyName "Exchange Federated Sharing" -DomainName $env:USERDNSDOMAIN -Services Federation -KeySize 2048 -PrivateKeyExportable $true -SubjectKeyIdentifier $ski
```

```powershell
Get-ExchangeCertificate | ?{$_.FriendlyName -eq "Exchange Federated Sharing"} | New-FederationTrust -Name "Azure AD Authentication"
```

Azure AD uses this certificate to sign and encrypt delegation tokens for federated sharing. It doesn't use it to identify your organization. As such, the name in the certificate isn't relevant.

As an alternative to using self-signed certificates generated either through the Federated Trust wizard or by running the **New-ExchangeCertificate** cmdlet, you can also use an external x.509 certificate for federation. To use an x.509 certificate, you must ensure the correct subject alternative names (SAN) in the certificate are available.

> [!TIP]
> The downside to using an external x.509 certificate is that the process to create one is far more complex compared to creating a self-signed certificate within Exchange.
