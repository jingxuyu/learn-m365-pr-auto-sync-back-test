Microsoft Defender for Identity is a cloud-based security solution. It uses an organization's on-premises Active Directory information to identify, detect, and analyze potential threats, compromised accounts, and malicious insider actions inside the organization. Defender for Identity monitors not just user accounts, but all devices in an organization's network that perform authentication and authorization requests against Active Directory, including non-Windows and mobile devices. Besides analyzing an organization's Active Directory traffic using deep packet inspection technology, Defender for Identity also collects relevant Windows Events from the organization's domain controller and creates entity profiles based on information from Active Directory Domain Services.

The Defender for Identity service helps security administrators that find it challenging to detect advanced attacks that occur in a hybrid environment. To get a better understanding of Microsoft Defender for identity, this unit will review key components that make up the service and how administrators can use this service to increase the threat resilience of their organization.

### What does Microsoft Defender for Identity do?

Microsoft Defender for Identity monitors an organization's domain controllers by capturing and parsing network traffic and using Windows events directly from the domain controllers. It then analyzes the data for attacks and threats. Using profiling, deterministic detection, machine learning, and behavioral algorithms, Defender for Identity learns about an organization's network, enables detection of anomalies, and provides warnings of suspicious activities.

With Defender for Identity, there's no need to create rules, thresholds, or baselines and then fine-tune. Defender for Identity analyzes the behaviors among users, devices, and resources, along with their relationship to one another. In doing so, it can quickly detect suspicious activity and known attacks.

 -  Defender for Identity will start detecting known malicious attacks and security issues immediately after deployment.
 -  Three weeks after deployment, Defender for Identity starts to detect suspicious behavioral activities.

Defender for Identity performs the following tasks:

 -  **Monitors and profiles user behavior and activities.** Defender for Identity monitors and analyzes user activities and information across an organization's network. This information includes permissions and group membership. In doing so, it creates a behavioral baseline for each user.<br><br>Defender for Identity then identifies anomalies with adaptive built-in intelligence. This action provides organizations with insights into suspicious activities and events, revealing the advanced threats, compromised users, and insider threats facing the organizations. Defender for Identity's proprietary sensors monitor organizational domain controllers, providing a comprehensive view for all user activities from every device.<br>
 -  **Protects user identities and reduces the attack surface.** Defender for Identity provides invaluable insights on identity configurations and suggested security best-practices. Through security reports and user profile analytics, Defender for Identity helps dramatically reduce an organization's attack surface, making it harder to compromise user credentials and advance an attack.<br><br>Defender for Identity's visual Lateral Movement Paths helps companies quickly understand exactly how an attacker can move laterally inside their organizations to compromise sensitive accounts and help prevent those risks in advance. The security reports generated by Defender for Identity help organizations identify users and devices that authenticate using clear-text passwords. They also provide other insights to improve an organization's security posture and policies.<br>
 -  **Protects AD FS in hybrid environments.** Active Directory Federation Services (AD FS) plays important role in today's infrastructure when it comes to authentication in hybrid environments. Defender for Identity protects the AD FS in an organization's environment by detecting on-premises attacks on the AD FS and providing visibility into authentication events generated by the AD FS.<br>
 -  **Identifies suspicious activities and advanced attacks across the cyber-attack kill-chain.** Most attacks are launched against an accessible entity, such as a low-privileged user. The attack then moves laterally until the attacker gains access to valuable assets â€“ such as sensitive accounts, domain administrators, and highly sensitive data. Defender for Identity identifies the following advanced threats at the source throughout the entire cyber-attack kill chain:
    
     -  **Reconnaissance.** Identify rogue users and attackers' attempts to gain information. Attackers use various methods to search for information about user names, users' group membership, IP addresses assigned to devices, resources, and more.
     -  **Compromised credentials.** Identify attempts to compromise user credentials using brute force attacks, failed authentications, user group membership changes, and other methods.
     -  **Lateral movements.** Detect attempts to move laterally inside the network to gain further control of sensitive users. It uses methods such as Pass the Ticket, Pass the Hash, Overpass the Hash, and more.
     -  **Domain dominance.** Highlight attacker behavior if domain dominance is achieved through remote code execution on the domain controller, and methods such as DC Shadow, malicious domain controller replication, Golden Ticket activities, and more.
 -  **Investigates alerts and user activities.** Defender for Identity is designed to reduce general alert noise. It provides only relevant, important security alerts in a simple, real-time organizational attack timeline. The **Defender for Identity attack timeline** view enables organizations to easily stay focused on what matters by using the intelligence of smart analytics.<br><br>Defender for Identity can quickly investigate threats and gain insights across the organization for users, devices, and network resources. Integration with Microsoft Defender for Endpoint provides another layer of enhanced security. It does so by providing detection and protection against advanced persistent threats on the operating system.

### **Defender for Identity architecture**

Using profiling, deterministic detection, machine learning, and behavioral algorithms, Defender for Identity learns about an organization's network, enables detection of anomalies, and provides warnings of suspicious activities. It provides these services through the integration of the following key components:

 -  **Defender for Identity portal.** The Defender for Identity portal enables an organization to create its Defender for Identity instance. The portal also displays the data received from Defender for Identity sensors, and enables an organization to monitor, manage, and investigate threats in its network environment.
 -  **Defender for Identity sensor.** Every domain controller in a company's environment should be covered by a Defender for Identity sensor or standalone sensor. Installed directly on an organization's domain controller or AD FS servers, the Defender for Identity sensor accesses the event logs it requires directly from the servers. The sensor sends only the parsed information retrieved from the logs and network traffic to the Defender for Identity cloud service (only a percentage of the logs are sent). Defender for Identity sensors can be installed directly on the following servers:
    
     -  **Domain controllers**. The sensor directly monitors domain controller traffic, with no dedicated server, or configuration of port mirroring.
     -  **AD FS servers**. The sensor directly monitors network traffic and authentication events.
 -  **Defender for Identity cloud service.** Defender for Identity cloud service runs on Azure infrastructure. It's currently deployed in the US, Europe, and Asia. Defender for Identity cloud service is connected to Microsoft's intelligent security graph.

:::image type="content" source="../media/defender-for-identity-architecture-e38d0780.png" alt-text="diagram showing the Defender for identity architecture":::


By default, Defender for Identity supports up to 200 sensors. If you want to install more sensors, contact Defender for Identity support at Microsoft.

The Defender for Identity sensor includes a monitoring component that evaluates the available compute and memory capacity on the domain controller on which it's running. The monitoring process runs every 10 seconds and dynamically updates the CPU and memory utilization quota on the Defender for Identity sensor process. The monitoring process makes sure the domain controller always has at least 15% of free compute and memory resources available.

No matter what occurs on the domain controller, the monitoring process continually frees up resources for maintaining the domain controller's core functionality. If the monitoring process causes the Defender for Identity sensor to run out of resources, only partial traffic will be monitored and the health alert "Dropped port mirrored network traffic" appears in the Defender for Identity portal Health page.

### **Defender for Identity data collection**

Defender for Identity collects and stores information from an organization's configured servers (domain controllers, member servers, and so on). This information is stored in a database specific to the service for administration, tracking, and reporting purposes. Information collected includes:

 -  network traffic to and from domain controllers (such as Kerberos authentication, NTLM authentication, and DNS queries).
 -  security logs (such as Windows security events).
 -  Active Directory information (structure, subnets, sites).
 -  entity information (such as names, email addresses, and phone numbers).

Microsoft uses this data to:

 -  Proactively identify indicators of attack in an organization.
 -  Generate alerts if a possible attack was detected.
 -  Provide an organization's security operations team with a view into entities related to threat signals from its network. This view enables the organization to investigate and explore the presence of security threats on its network.

> [!IMPORTANT]
> Microsoft doesn't mine your data for advertising or for any other purpose other than providing you the Defender for Identity service.

### **Deploying Microsoft Defender for Identity**

It's recommended that organizations deploy Defender for Identity in three phases:

 -  **Phase 1:**
    
    1.  [Install Defender for Identity](/defender-for-identity/install-step1?azure-portal=true) to protect your primary environments. Defender for Identity's fast deployment model enables organizations to start protecting their environments immediately.
    2.  Set [sensitive accounts](/defender-for-identity/manage-sensitive-honeytoken-accounts?azure-portal=true) and [honey token accounts](/defender-for-identity/configure-detection-exclusions?azure-portal=true).
    3.  Review reports and [lateral movement paths](/defender-for-identity/use-case-lateral-movement-path?azure-portal=true).
 -  **Phase 2:**
    
    1.  Protect all the domain controllers and forests in the organization.
    2.  Monitor all alerts. Investigate lateral movement and domain dominance alerts.
    3.  Work with the [Security Alert guide](/defender-for-identity/suspicious-activity-guide?azure-portal=true) to understand threats and triage potential attacks.
 -  **Phase 3:**
    
    1.  Integrate Defender for Identity alerts into your security operation's workflows.
