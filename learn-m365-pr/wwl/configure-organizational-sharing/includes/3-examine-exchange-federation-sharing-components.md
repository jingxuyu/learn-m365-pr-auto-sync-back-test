To configure Exchange federated sharing successfully, you must first become familiar with the components that are involved. The components used in federated sharing include:

 -  **Federation trust with the Azure AD authentication system**. Used as a trust broker.
 -  **AppID.** A unique number generated by the Azure Active Directory authentication system to identify Exchange organizations.
 -  **OrgID.** Defines which of the authoritative accepted domains configured in an organization are enabled for federation.
 -  **Self-signed certificate.** Signs and encrypts delegation tokens.
 -  **TXT resource record in DNS.** Validates domain ownership.

### Federation trust with the Azure AD authentication system

The most important component of federated sharing is the federation trust with the Azure AD authentication system. The Azure AD authentication system is the new name for what was previously known as the Microsoft Federation Gateway.

The Azure AD authentication system is an Azure-based service, which is a free Microsoft offering that acts as a trust broker between two federated Exchange Server organizations. Instead of establishing a direct trust as with forest trusts in Active Directory Domain Services (AD DS), you establish a trust between your Exchange server environment and the Azure AD authentication system. Other organizations must establish the same federated trust relationship with an Azure AD authentication system before you can start sharing information with them. When you have an Azure AD authentication system acting as the trust broker for your organization, you don't need to establish multiple or individual trust relationships with other organizations.

After you configure a trust with the Azure AD authentication system, the Azure AD authentication system service issues a Security Assertion Markup Language (SAML) delegation token for each user that the on-premises Active Directory domain controllers authenticate. This token enables the authenticated user to access shared resources within federated Exchange Server organizations.

If you establish a trust with the Azure AD authentication system, your organization exchanges digital certificates with the Azure AD authentication-system certificate, including federation metadata.

### Self-signed certificates

Running the Federated Trust wizard creates the trust with the Azure AD authentication system. You can use either the Exchange Admin Center (EAC) or the Exchange Management Shell (EMS) to run the wizard. If you use the EMS, you must run the **New-FederationTrust** cmdlet.

The Federated Trust wizard creates a self-signed certificate for federation. It then replicates this certificate to all Exchange Servers. The certificate is then used to sign and encrypt delegation tokens from the Azure AD authentication system. This process enables external federated organizations to trust end users.

### AppID and TXT resource records

When you create a federation trust with the Azure AD authentication system, Azure AD creates an object called an application identifier (AppID). You can reach this object by running the **Get-FederationTrust** cmdlet in the Exchange Management Shell. AppID uniquely identifies your Exchange Server organization on the Azure AD authentication system’s side when establishing relationships with another Exchange Server organization. AppID also provides valid proof that an organization is the owner of the domain that it uses for federation. This proof of ownership is accomplished by creating a text (TXT) resource with the AppID in the public DNS zone for each federated domain. To obtain the content of the TXT record, you should run the following command:

```
Get-FederatedDomainProof –domainname <NameOfDomain>
```

This **Get-FederatedDomainProof** cmdlet returns the value of the TXT resource record that you place in the DnsRecord field in the DNS. You can then use the DNS Manager to create a TXT resource record in your public DNS that contains the domain proof’s content.

### OrgID

When you configure federation, you must define which of your organization’s authoritative accepted domains to use and enable for federation. This domain is then stored in a federated organization identifier (OrgID).

> [!IMPORTANT]
> This parameter must be defined because only users that have email addresses for the domain that’s configured in the OrgID can use the Exchange Server federation features.

OrgID is a combination of a predefined string and an accepted domain. The domain that is in OrgID is the domain that you select as the primary shared domain in the Federated Trust Wizard when you create a federated trust.

For example, let's assume you specify the federated domain **adatum.com** as the primary shared domain in your organization. As a result, the **FYDIBOHF25SPDLT.adatum.com** account namespace is automatically created as the OrgID for your Exchange Server organization’s federation trust. You can set OrgID by running the following command:

```
Set-FederatedOrganizationIdentifier –Enabled $true
```

> [!IMPORTANT]
> To enable or disable all federation sharing features in your organization, you must enable or disable the OrgID for the federation trust.

Federated sharing uses Autodiscover to verify your domain. As such, Autodiscover must be implemented, and it must be working from the Internet.

> [!TIP]
> You can use the [Remote Connectivity Analyzer](https://testconnectivity.microsoft.com/tests/o365?azure-portal=true) tool to verify the Autodiscover status for your Exchange organization.

## Knowledge check

Choose the best response for the following question. Then select **Check your answers**.